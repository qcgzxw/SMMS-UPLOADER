/*
Plugin Name: SM.MS图床外链小工具
Plugin URI: https://www.qcgzxw.cn/2555.html
Description: 小文博客独自开发的图床插件，用于WordPress博客添加 图床上传小工具、评论处图片上传按钮、文章编辑处图片上传按钮。
Author: 小文博客
Author URI: https://www.qcgzxw.cn/
Version: 4.2
License: GPL version 2 or later - http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
自定义小工具CSS样式部分
*/
jQuery(document).ready(function($){$('#admin-img-file').change(function(){for(var i=0;i<this.files.length;i++){var f=this.files[i];var formData=new FormData();formData.append('smfile',f);$.ajax({url:'https://sm.ms/api/upload',type:'POST',processData:false,contentType:false,data:formData,success:function(res){$('textarea[name="content"]').insertAtCaret('<img class="aligncenter" src="'+res.data.url+'" />');$("html").find("iframe").contents().find("body").append('<img class="aligncenter" src="'+res.data.url+'" />')}})}});$.fn.extend({insertAtCaret:function(myValue){var $t=$(this)[0];if(document.selection){this.focus();sel=document.selection.createRange();sel.text=myValue;this.focus()}else if($t.selectionStart||$t.selectionStart=="0"){var startPos=$t.selectionStart;var endPos=$t.selectionEnd;var scrollTop=$t.scrollTop;$t.value=$t.value.substring(0,startPos)+myValue+$t.value.substring(endPos,$t.value.length);this.focus();$t.selectionStart=startPos+myValue.length;$t.selectionEnd=startPos+myValue.length;$t.scrollTop=scrollTop}else{this.value+=myValue;this.focus()}}})})